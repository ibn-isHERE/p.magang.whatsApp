<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Pesan Pengingat</title>
    <link
      rel="icon"
      type="image/x-icon"
      href="/wa_pengingat/public/asset/result_bps.png"
    />
    <link rel="stylesheet" href="chat_style.css" />
    <link rel="stylesheet" href="style.css" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <script src="/socket.io/socket.io.js"></script>
  </head>

  <body>
    <div class="navbar">
      <div class="navbar-left">
        <img
          src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/28/Lambang_Badan_Pusat_Statistik_%28BPS%29_Indonesia.svg/1726px-Lambang_Badan_Pusat_Statistik_%28BPS%29_Indonesia.svg.png"
          alt="Logo BPS"
        />
        <span class="navbar-text">Badan Pusat Statistik</span>
      </div>
    </div>

    <main>
      <div class="app-header">
        <h1>Pesan Pengingat WhatsApp</h1>
      </div>

      <div class="main-content">
        <section class="form-container">
          <div class="tabs">
            <div id="main-tabs">
              <button class="tab-button active" onclick="showForm('message')">
                <i class="fa-solid fa-envelope"></i> Kirim Pesan
              </button>
              <button class="tab-button" onclick="showForm('meeting')">
                <i class="fa-solid fa-calendar-check"></i> Jadwal Rapat
              </button>
              <button class="tab-button" onclick="showForm('contacts')">
                <i class="fa-solid fa-address-book"></i> Manajemen Kontak
              </button>
              <button class="tab-button" onclick="showForm('group')">
                <i class="fa-solid fa-users"></i> Manajemen Grup
              </button>
              <button class="tab-button" onclick="showForm('chat')">
                <i class="fa-solid fa-comments"></i> Customer Service
                <span
                  id="chatBadge"
                  class="notification-badge"
                  style="display: none"
                  >0</span
                >
              </button>
            </div>
            <button id="edit-tab" class="tab-button" style="display: none">
              <i class="fa-solid fa-pencil"></i> Edit Jadwal
            </button>
          </div>

          <div id="messageFormContainer" class="form-content active">
            <h2>Buat Jadwal Pesan</h2>
            <form id="reminderForm" enctype="multipart/form-data">
              
              <!-- SECTION PILIH KONTAK INDIVIDUAL -->
              <label for="contactSearch">Pilih Kontak dari Daftar:</label>
              <input
                type="text"
                id="contactSearch"
                placeholder="Cari kontak..."
                autocomplete="off"
              />
              <div class="select-all-container">
                <label for="selectAllContacts">Pilih Semua</label>
                <input type="checkbox" id="selectAllContacts" />
              </div>
              <div id="contactList" class="contact-checklist-box"></div>

              <!-- ðŸ†• SECTION PILIH GRUP -->
              <label style="margin-top: 20px; display: block;">
                <i class="fa-solid fa-users"></i> Atau Pilih Grup:
              </label>
              <div id="groupSelectionList" class="contact-checklist-box" style="max-height: 200px; overflow-y: auto; margin-bottom: 8px;"></div>
              <div id="groupSelectionInfo" style="margin-top: 5px; margin-bottom: 15px; padding: 8px; background: #f0f0f0; border-radius: 4px; color: #666;">
                <small>Belum ada grup dipilih</small>
              </div>

              <!-- NOMOR MANUAL -->
              <label for="manualNumbers">Nomor Manual (pisahkan dengan koma):</label>
              <input
                type="text"
                id="manualNumbers"
                placeholder="08123456789, 08234567890"
              />

              <div class="file-upload-section">
                <label>Pilih File (Gambar, Video, PDF):</label>
                <div class="file-upload-container">
                  <input
                    type="file"
                    id="fileUpload"
                    name="fileUpload"
                    accept="image/*,video/*,application/pdf"
                    multiple
                  />
                  <span class="file-upload-label" data-input="fileUpload"
                    >Klik untuk memilih file</span
                  >
                  <div id="customFilePreview"></div>
                </div>
                <button
                  type="button"
                  id="clearAllFilesBtn"
                  style="display: none; background-color: #dc3545"
                >
                  Hapus Seluruh File
                </button>
              </div>

              <label for="message">Pesan:</label>
              <textarea
                id="message"
                name="message"
                placeholder="Tulis pesan..."
                rows="4"
              ></textarea>
              <label for="datetime">Waktu Kirim:</label>
              <input
                type="datetime-local"
                id="datetime"
                name="datetime"
                required
              />
              <button type="submit">Kirim</button>
            </form>
          </div>

          <div id="meetingFormContainer" class="form-content hidden">
            <h2>Buat Jadwal Rapat</h2>
            <form id="addMeetingForm">
              <label for="meetingTitle">Judul Rapat:</label>
              <input type="text" id="meetingTitle" required />

              <!-- SECTION PILIH KONTAK INDIVIDUAL -->
              <label for="meetingContactSearch">Pilih Kontak dari Daftar:</label>
              <input
                type="text"
                id="meetingContactSearch"
                placeholder="Cari kontak..."
                autocomplete="off"
              />
              <div class="select-all-container">
                <label for="selectAllMeetingContacts">Pilih Semua</label>
                <input type="checkbox" id="selectAllMeetingContacts" />
              </div>
              <div id="meetingContactList" class="contact-checklist-box"></div>

              <!-- ðŸ†• SECTION PILIH GRUP UNTUK MEETING -->
              <label style="margin-top: 20px; display: block;">
                <i class="fa-solid fa-users"></i> Atau Pilih Grup:
              </label>
              <div id="meetingGroupSelectionList" class="contact-checklist-box" style="max-height: 200px; overflow-y: auto; margin-bottom: 8px;"></div>
              <div id="meetingGroupSelectionInfo" style="margin-top: 5px; margin-bottom: 15px; padding: 8px; background: #f0f0f0; border-radius: 4px; color: #666;">
                <small>Belum ada grup dipilih</small>
              </div>

              <label for="meetingNumbers">Nomor Manual (pisahkan dengan koma):</label>
              <input
                type="text"
                id="meetingNumbers"
                placeholder="081234567890, 089876543210"
              />

              <div class="file-upload-section">
                <label>Pilih File untuk Rapat (Gambar, Video, PDF):</label>
                <div class="file-upload-container">
                  <input
                    type="file"
                    id="meetingFileUpload"
                    name="files"
                    accept="image/*,video/*,application/pdf"
                    multiple
                  />
                  <span class="file-upload-label" data-input="meetingFileUpload"
                    >Klik untuk memilih file</span
                  >
                  <div id="meetingFileNames" class="customFilePreview">
                    Belum ada file terpilih
                  </div>
                </div>
                <button
                  type="button"
                  id="clearAllMeetingFilesBtn"
                  style="display: none; background-color: #dc3545"
                >
                  Hapus Seluruh File
                </button>
              </div>

              <label for="meetingRoom">Ruangan Rapat:</label>
              <select id="meetingRoom" required>
                <option value="">-- Pilih Ruangan --</option>
                <option value="Aula Lantai 3">Aula Lantai 3</option>
                <option value="Ruang Sungkai">Ruang Sungkai</option>
                <option value="Ruang distribusi">Ruang distribusi</option>
                <option value="Ruang Garda SE">Ruang Garda SE</option>
                <option value="Ruang PST">Ruang PST</option>
              </select>

              <div class="form-group">
                <label for="meetingStartTime">Waktu Mulai Rapat:</label>
                <input
                  type="datetime-local"
                  id="meetingStartTime"
                  class="form-control"
                  required
                />
              </div>

              <div class="form-group">
                <label for="meetingEndTime">Waktu Selesai Rapat:</label>
                <input
                  type="datetime-local"
                  id="meetingEndTime"
                  class="form-control"
                  required
                />
              </div>

              <button type="submit">Jadwalkan Rapat</button>
            </form>
          </div>

          <div id="editFormContainer" class="form-content hidden"></div>

          <div id="contactsFormContainer" class="form-content hidden">
            <h2>Manajemen Kontak</h2>
            <form id="contact-crud-form">
              <h3>Tambah / Edit Kontak</h3>
              <input type="hidden" id="contact-crud-id" />
              <input
                type="text"
                id="contact-crud-name"
                class="phone-num-input"
                placeholder="Nama Kontak"
                required
              />
              <input
                type="tel"
                id="contact-crud-number"
                class="phone-num-input"
                placeholder="Nomor (contoh: 0812...)"
                style="margin-top: 8px"
                required
              />
              <select
                id="contact-crud-instansi"
                style="margin-top: 8px"
                required
              >
                <option value="">-- Pilih Instansi --</option>
                <option value="Tim ZI">Tim ZI</option>
                <option value="Tim Umum">Tim Umum</option>
                <option value="Tim Statistik Sosial">
                  Tim Statistik Sosial
                </option>
                <option value="Tim Statistik Distribusi">
                  Tim Statistik Distribusi
                </option>
                <option value="Tim Neraca Wilayah dan Analisis Statistik">
                  Tim Neraca Wilayah dan Analisis Statistik
                </option>
                <option value="Tim Statistik Produksi">
                  Tim Statistik Produksi
                </option>
                <option value="Tim IPDS (TI)">Tim IPDS (TI)</option>
                <option value="Tim IPDS (DLS)">Tim IPDS (DLS)</option>
                <option value="Tim Administrasi">Tim Administrasi</option>
                <option value="Tim Humas dan UKK">Tim Humas dan UKK</option>
                <option value="Tim Statistik Sektoral">
                  Tim Statistik Sektoral
                </option>
                <option value="Tim Manajemen dan Tata Kelola">
                  Tim Manajemen dan Tata Kelola
                </option>
              </select>
              <select
                id="contact-crud-jabatan"
                style="margin-top: 8px"
                required
              >
                <option value="">-- Pilih Jabatan --</option>
                <option value="Kepala Bagian Umum">Kepala Bagian Umum</option>
                <option value="Pegawai">Pegawai</option>
              </select>
              <select id="contact-crud-grup" style="margin-top: 8px">
                <option value="">-- Pilih Grup --</option>
              </select>
              <button type="submit" id="contact-crud-submit">
                Tambah Kontak
              </button>
              <button
                type="button"
                id="contact-crud-cancel"
                style="display: none; background-color: #6c757d"
              >
                Batal
              </button>
            </form>

            <form
              id="import-form"
              action="/api/import"
              method="post"
              enctype="multipart/form-data"
            >
              <h3>Import Kontak dari File</h3>
              <input
                type="file"
                name="contactFile"
                accept=".csv, .json, .xlsx, .xls"
                required
              />
              <button type="submit">Import</button>
            </form>
          </div>

          <div id="groupsFormContainer" class="form-content hidden">
            <h2>Manajemen Grup</h2>
            <form id="group-crud-form">
              <h3>Tambah / Edit Grup</h3>
              <input type="hidden" id="group-crud-id" />
              <label for="group-crud-name">Nama Grup:</label>
              <input
                type="text"
                id="group-crud-name"
                placeholder="Contoh: Tim TI, Semua Pegawai"
                required
              />

              <label for="groupContactSearch">Cari Kontak:</label>
              <input
                type="text"
                id="groupContactSearch"
                placeholder="Cari kontak..."
                autocomplete="off"
              />
              <div class="select-all-container">
                <label for="selectAllGroupContacts">Pilih Semua Anggota</label>
                <input type="checkbox" id="selectAllGroupContacts" />
              </div>
              <div id="groupContactList" class="contact-checklist-box">
                <p style="text-align: center">Memuat daftar kontak...</p>
              </div>

              <input type="hidden" id="group-crud-members" value="" />

              <button type="submit" id="group-crud-submit">Tambah Grup</button>
              <button
                type="button"
                id="group-crud-cancel"
                style="display: none; background-color: #6c757d"
              >
                Batal
              </button>
            </form>
          </div>

          <div id="chatSidebarContainer" class="form-content hidden">
            <div class="chat-tabs">
              <button class="chat-tab-button active" data-status="active">
                Daftar Percakapan
              </button>
              <button class="chat-tab-button" data-status="history">
                History Chat
              </button>
            </div>

            <div class="chat-search">
              <input
                type="text"
                id="chatSearch"
                placeholder="Cari nomor atau pesan..."
              />
              <i class="fa-solid fa-search"></i>
            </div>

            <div class="chat-list" id="chatList"></div>
          </div>
        </section>

        <section class="content-area">
          <div class="schedule-container" id="scheduleContainer">
            <div class="schedule-header">
              <h2>Jadwal Pesan Terkirim/Terjadwal</h2>
              <div class="filter-buttons d-flex justify-content-center mb-3">
                <button class="filter-button active" data-filter="all">
                  Semua
                </button>
                <button class="filter-button" data-filter="meeting">
                  Jadwal Rapat
                </button>
                <button class="filter-button" data-filter="terjadwal">
                  Terjadwal
                </button>
                <button class="filter-button" data-filter="terkirim">
                  Terkirim
                </button>
                <button class="filter-button" data-filter="dibatalkan">
                  Dibatalkan
                </button>
                <button class="filter-button" data-filter="gagal">Gagal</button>
              </div>
            </div>

            <div class="table-wrapper">
              <table id="scheduleTable">
                <thead>
                  <tr>
                    <th>Waktu Terjadwal</th>
                    <th>Nomor Tujuan</th>
                    <th>Pesan</th>
                    <th>File</th>
                    <th>Status</th>
                    <th>Aksi</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>

          <div
            class="chat-main-container"
            id="chatMainContainer"
            style="display: none"
          >
            <div class="chat-header" id="chatHeader">
              <div class="chat-info">
                <h3 id="activeContactName">Pilih percakapan</h3>
                <span id="activeContactNumber"></span>
              </div>
              <div class="chat-actions">
                <button id="refreshChatBtn" title="Refresh">
                  <i class="fa-solid fa-refresh"></i>
                </button>
                <button id="endChatBtn" title="Akhiri Chat" style="color: red">
                  <i class="fa-solid fa-ban"></i>
                </button>
              </div>
            </div>

            <div class="chat-messages" id="chatMessages">
              <div class="no-chat-selected">
                <i class="fa-solid fa-comments"></i>
                <p>Pilih percakapan untuk mulai chat</p>
              </div>
            </div>

            <div
              class="chat-input-area"
              id="chatInputArea"
              style="display: none"
            >
              <div class="chat-input-container">
                <input
                  type="file"
                  id="chatFileInput"
                  accept="image/*,video/*,application/pdf"
                  style="display: none"
                />
                <button id="attachFileBtn" title="Lampirkan File">
                  <i class="fa-solid fa-paperclip"></i>
                </button>

                <input
                  type="text"
                  id="replyInput"
                  placeholder="Ketik balasan..."
                />

                <button id="sendReplyBtn" title="Kirim">
                  <i class="fa-solid fa-paper-plane"></i>
                </button>
              </div>
            </div>
          </div>

          <div id="contactMainContainer" class="contact-main-container">
            <div class="schedule-header">
              <h3>Daftar Kontak Tersimpan</h3>
            </div>

            <div class="table-wrapper">
              <table id="contact-management-table">
                <thead>
                  <tr>
                    <th>Nama</th>
                    <th>Nomor</th>
                    <th>Instansi</th>
                    <th>Jabatan</th>
                    <th>Grup</th>
                    <th>Aksi</th>
                  </tr>
                </thead>
                <tbody id="contact-management-tbody"></tbody>
              </table>
            </div>
          </div>

          <div id="groupMainContainer" class="contact-main-container">
            <div class="schedule-header">
              <h3>Daftar Grup Tersimpan</h3>
            </div>

            <div class="table-wrapper">
              <table id="group-management-table">
                <thead>
                  <tr>
                    <th>Nama Grup</th>
                    <th>Jumlah Anggota</th>
                    <th>Aksi</th>
                  </tr>
                </thead>
                <tbody id="group-management-tbody"></tbody>
              </table>
            </div>
          </div>
        </section>
      </div>
    </main>

    <footer class="footer">
      <p>&copy; 2025 Pesan Pengingat. All rights reserved.</p>
    </footer>

    <div id="mediaModal" class="modal">
      <span class="close-modal" onclick="closeMediaModal()">&times;</span>
      <div class="modal-content" id="modalContent"></div>
      <a id="downloadLink" class="download-button" download>
        <i class="fa-solid fa-download"></i> Unduh
      </a>
    </div>

    <audio id="notificationSound" preload="auto">
      <source type="audio/wav" src=" //biarkan kosong dulu" />
    </audio>

    <div id="editModal" class="edit-modal">
      <div class="edit-modal-content">
        <div class="edit-modal-header">
          <h2 id="editModalTitle">Edit Jadwal</h2>
          <button class="edit-modal-close" onclick="closeEditModal()">
            &times;
          </button>
        </div>
        <div id="editModalBody"></div>
      </div>
    </div>

    <div id="editContactModal" class="edit-modal">
      <div class="edit-modal-content">
        <div class="edit-modal-header">
          <h2 id="editContactModalTitle">Edit Kontak</h2>
          <button class="edit-modal-close" onclick="closeEditContactModal()">
            &times;
          </button>
        </div>
        <div id="editContactModalBody"></div>
      </div>
    </div>

    <script type="module" src="main.js"></script>
  </body>
</html>